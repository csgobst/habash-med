<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <link rel="icon" type="image/svg+xml" href="/habash-med/vite.svg" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta
      name="description"
      content="Founded in 2018 in Damascus, Habash Med supplies ophthalmic equipment, disposables, and on-site technical support to clinics and hospitals across Syria."
    />
    <title>Habash Med â€” Ophthalmic Products & Technical Services in Syria</title>
    <!-- GitHub Pages SPA redirect handling with enhanced error recovery -->
    <script>
      ;(function () {
        var l = window.location
        var errorCount = 0
        var MAX_RETRIES = 2

        // Enhanced GitHub Pages SPA support with error handling
        try {
          // Handle redirected URLs
          if (l.search[1] === '/') {
            var decoded = l.search
              .slice(1)
              .split('&')
              .map(function (s) {
                return s.replace(/~and~/g, '&')
              })
              .join('?')
            window.history.replaceState(null, null, l.pathname.slice(0, -1) + decoded + l.hash)
          }

          // Ensure we're on the correct base path
          var basePath = '/habash-med'
          if (l.pathname === '/' || l.pathname === '') {
            window.location.replace(basePath + '/')
          } else if (!l.pathname.startsWith(basePath) && l.pathname !== '/404.html') {
            window.location.replace(basePath + '/#' + l.pathname)
          }
        } catch (error) {
          console.error('Routing error:', error)
          // Fallback to home page
          window.location.replace('/habash-med/')
        }

        // Enhanced error handling for failed loads
        window.addEventListener('error', function (e) {
          console.error('Resource failed to load:', e.target.src || e.target.href || e.message)
          errorCount++

          if (e.target && e.target.tagName === 'SCRIPT' && e.target.src) {
            // If main script fails and we haven't retried too many times
            if (errorCount <= MAX_RETRIES) {
              console.warn('Script failed to load, attempting reload in 2 seconds...')
              setTimeout(function () {
                window.location.reload()
              }, 2000)
            } else {
              // Show fallback content
              document.body.innerHTML =
                '<div style="padding: 20px; text-align: center; font-family: Arial, sans-serif; background: #0a0a0f; color: #f9fafb; min-height: 100vh; display: flex; flex-direction: column; justify-content: center; align-items: center;">' +
                '<h1 style="color: #ef4444;">Failed to Load</h1>' +
                '<p>Unable to load the application. Please check your connection and try again.</p>' +
                '<button onclick="window.location.reload()" style="padding: 10px 20px; background: #6366f1; color: white; border: none; border-radius: 5px; cursor: pointer; margin-top: 20px;">Reload Page</button>' +
                '</div>'
            }
          }
        })

        // Clean up any existing service workers that might cause issues
        if ('serviceWorker' in navigator) {
          navigator.serviceWorker
            .getRegistrations()
            .then(function (registrations) {
              for (let registration of registrations) {
                registration.unregister()
                console.log('Unregistered service worker:', registration)
              }
            })
            .catch(function (error) {
              console.warn('Service worker cleanup failed:', error)
            })
        }

        // Memory cleanup for better performance
        window.addEventListener('beforeunload', function () {
          // Clear any remaining timers or intervals
          var highestId = setTimeout(function () {}, 0)
          for (var i = 0; i < highestId; i++) {
            clearTimeout(i)
          }
        })
      })()
    </script>
  </head>
  <body>
    <div id="root"></div>
    <script type="module" src="./src/main.jsx"></script>
  </body>
</html>
